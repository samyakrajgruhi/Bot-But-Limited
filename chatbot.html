<!DOCTYPE html>
<html>
	<head>
		<title>Chat Bot</title>
	</head>
	<body>
		<div class="js-container"></div>

		<script src="https://unpkg.com/supersimpledev/react.js"></script>
		<script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
		<script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

		<script src="https://unpkg.com/supersimpledev/babel.js"></script>
		<script type="text/babel">

		function ChatMessage({message,sender,id}){
			// const message = props.message;
			// const sender = props.sender;
			// const {message,sender} = props;
			return (
				<div>
					{sender === 'robot' && (
						<img src="images/robot.png" width="50" />
					)} 
					{message}
					{sender === 'user' && (
						<img src="images/user.png" width="50" />
					)}
				</div>
			);
		}

		function ChatInput({chatMessages,setChatMessages}){
			const [inputText, setInputText] = React.useState('');

			function saveToText(event){
				setInputText(event.target.value);
			}

			function sendMessage(){

				const newChatMessages = [
					...chatMessages,{
						message: inputText,
						sender: 'user',
						id: crypto.randomUUID()
					}
				];

				setChatMessages(newChatMessages);
				
				const botResponse = Chatbot.getResponse(inputText);

				setChatMessages([
					...newChatMessages,{
						message: botResponse,
						sender:'robot',
						id: crypto.randomUUID()
					}]
				);
				
				setInputText('');
			}

			function sendWithEnter(event){
				if(event.key === 'Enter'){
					sendMessage();
				}else if(event.key === 'Escape'){
					setInputText('');
				}
			}

			return (
				<>
					<input 
						placeholder="Send a message to Chatbot" 
						size="30"
						onChange={saveToText}
						onKeyDown={sendWithEnter}
						value={inputText}
					/>
					<button
					onClick={sendMessage}
					>Send</button>
				</>
			);
		}

		function ChatMessages({chatMessages}){
			return (				
				<>
					{chatMessages.map((chatMessage)=>{
						return (
							<ChatMessage 
								message={chatMessage.message}
								sender={chatMessage.sender}
								key={chatMessage.id}
							/>
						);	
					})}
				</>
			);
		}

		function App(){
			const [chatMessages, setChatMessages] = React.useState([{
				message:'Hello chatbot',
				sender:'user',
				id:'id1'
			},{
				message:'Hello! How can I help you?',
				sender:'robot',
				id:'id2'
			},{
				message:'can you get me todays date?',
				sender:'user',
				id:'id3'
			},{
				message:'Today is January 27',
				sender:'robot',
				id:'id4'
			}]);
			// const [chatMessages, setChatMessages] = array;
			// const chatMessages = array[0];
			// const setChatMessages = array[1];	
			return (
			<>
				<ChatInput 
					chatMessages={chatMessages}
					setChatMessages={setChatMessages}
				/>
				<ChatMessages 
					chatMessages={chatMessages}
				/>
			</>
			);
		}

		const container = document.querySelector('.js-container');
		ReactDOM.createRoot(container).render(<App />);
		</script>
	</body>
</html>